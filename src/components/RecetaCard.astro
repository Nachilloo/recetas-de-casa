---
import type { Receta } from '../lib/types';

export interface Props {
  receta: Receta | any; // any para mantener compatibilidad con formato antiguo si es necesario
}

const { receta } = Astro.props;

// Soporte para ambos formatos: Supabase (directo) y Content Collections (con .data)
const isSupabase = 'slug' in receta && !('data' in receta);
const slug = isSupabase ? receta.slug : receta.slug;
const data = isSupabase ? receta : receta.data;

const { 
  title, 
  descripcion, 
  imagen, 
  imagen_alt, 
  imagenAlt,
  tiempo, 
  porciones, 
  categoria, 
  dificultad, 
  tags, 
  calorias 
} = data;

// Normalizar campo imagen_alt (Supabase) vs imagenAlt (Content Collections)
const alt = imagen_alt || imagenAlt;

const baseUrl = import.meta.env.BASE_URL;
---

<article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
  <a href={`${baseUrl}recetas/${slug}/`} class="block">
    <div class="relative">
      <img 
        src={`${baseUrl}${imagen.replace('/', '')}`} 
        alt={alt || title} 
        class="w-full h-48 object-cover"
        loading="lazy"
      />
      <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-full text-xs font-medium">
        ‚è±Ô∏è {tiempo}
      </div>
    </div>
    
    <div class="p-4">
      <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2">{title}</h3>
      
      {descripcion && (
        <p class="text-gray-600 text-sm mb-3 line-clamp-2">{descripcion}</p>
      )}
      
      <div class="flex items-center justify-between text-sm text-gray-500 mb-3">
        <span class="flex items-center gap-1">
          üë• {porciones} {porciones === 1 ? 'porci√≥n' : 'porciones'}
        </span>
        {calorias && (
          <span class="flex items-center gap-1">
            üî• {calorias} kcal
          </span>
        )}
      </div>
      
      <div class="flex items-center justify-between">
        <span class="inline-block bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">
          {categoria.charAt(0).toUpperCase() + categoria.slice(1).replace('-', ' ')}
        </span>
        
        <span class={`text-xs px-2 py-1 rounded-full ${
          dificultad === 'facil' ? 'bg-green-100 text-green-800' :
          dificultad === 'media' ? 'bg-yellow-100 text-yellow-800' :
          'bg-red-100 text-red-800'
        }`}>
          {dificultad === 'facil' ? 'F√°cil' : dificultad === 'media' ? 'Media' : 'Dif√≠cil'}
        </span>
      </div>
      
      {tags && tags.length > 0 && (
        <div class="mt-3 flex flex-wrap gap-1">
          {tags.slice(0, 3).map(tag => (
            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full">
              #{tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </a>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
